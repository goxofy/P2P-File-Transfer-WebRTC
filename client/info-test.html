<!DOCTYPE html>
<html>
<head>
    <title>File Info Test</title>
</head>
<body>
    <h1>File Info Message Test</h1>
    <input type="file" id="test-file">
    <button id="send-info">Send File Info Only</button>
    <div id="log"></div>
    
    <script src="webrtc-manager.js"></script>
    <script>
        const log = document.getElementById('log');
        
        function addLog(message) {
            const div = document.createElement('div');
            div.textContent = `[${new Date().toLocaleTimeString()}] ${message}`;
            log.appendChild(div);
        }
        
        const manager = new WebRTCManager();
        
        manager.onDataChannelOpen = () => {
            addLog('DataChannel opened - ready to send messages');
        };
        
        manager.onDataChannelMessage = (data) => {
            try {
                const message = JSON.parse(data);
                addLog(`Received: ${message.type} - ${JSON.stringify(message)}`);
            } catch (e) {
                addLog(`Received raw: ${data}`);
            }
        };
        
        document.getElementById('send-info').addEventListener('click', () => {
            const fileInput = document.getElementById('test-file');
            if (fileInput.files.length === 0) {
                addLog('Please select a file first');
                return;
            }
            
            const file = fileInput.files[0];
            const fileInfo = {
                type: 'file-info',
                id: 'test-' + Date.now(),
                name: file.name,
                size: file.size,
                type: file.type
            };
            
            addLog(`Sending: ${JSON.stringify(fileInfo)}`);
            const success = manager.sendData(JSON.stringify(fileInfo));
            addLog(`Send result: ${success}`);
        });
        
        // Auto-connect for testing
        manager.connectToSignalingServer().then(() => {
            manager.joinRoom('info-test');
        });
    </script>
</body>
</html>